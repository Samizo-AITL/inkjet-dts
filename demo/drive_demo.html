<script type="module">
import { simulate } from "./dts.js";

const cvV = document.getElementById("cvV").getContext("2d");
const cvP = document.getElementById("cvP").getContext("2d");
const cvQ = document.getElementById("cvQ").getContext("2d");

const V = document.getElementById("V");
const D = document.getElementById("D");
const Z = document.getElementById("Z");

const Vv = document.getElementById("Vv");
const Dv = document.getElementById("Dv");
const Zv = document.getElementById("Zv");

function plot(ctx, data, scale=1){
  ctx.clearRect(0,0,700,150);
  ctx.beginPath();
  data.forEach((v,i)=>{
    ctx.lineTo(i*1.2, 75 - v*scale);
  });
  ctx.stroke();
}

function update(){
  const v = +V.value;
  const d = +D.value;
  const z = +Z.value;

  Vv.textContent = v;
  Dv.textContent = d;
  Zv.textContent = z;

  const {vin, P, Q} = simulate(v,d,z);

  plot(cvV, vin, 2);
  plot(cvP, P, 1);
  plot(cvQ, Q, 10);
}

[V,D,Z].forEach(e=>e.oninput = update);
update();
</script>
